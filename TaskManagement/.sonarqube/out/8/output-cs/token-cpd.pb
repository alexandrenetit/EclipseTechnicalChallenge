ô0
uC:\Labs\EclipseTechnicalChallenge\TaskManagement\src\TaskManagement.Infrastructure\Repositories\WorkItemRepository.cs
	namespace 	
TaskManagement
 
. 
Infrastructure '
.' (
Repositories( 4
;4 5
public 
class 
WorkItemRepository 
:  !
IWorkItemRepository" 5
{		 
private

 
readonly

  
ApplicationDbContext

 )
_context

* 2
;

2 3
public 

WorkItemRepository 
(  
ApplicationDbContext 2
context3 :
): ;
{ 
_context 
= 
context 
; 
} 
public 

async 
Task 
AddAsync 
( 
WorkItem '
entity( .
). /
{ 
await 
_context 
. 
	WorkItems  
.  !
AddAsync! )
() *
entity* 0
)0 1
;1 2
} 
public 

async 
Task 
DeleteAsync !
(! "
WorkItem" *
entity+ 1
)1 2
{ 
_context 
. 
	WorkItems 
. 
Remove !
(! "
entity" (
)( )
;) *
await 
Task 
. 
CompletedTask  
;  !
} 
public 

async 
Task 
< 
IEnumerable !
<! "
WorkItem" *
>* +
>+ ,
GetAllAsync- 8
(8 9
)9 :
{ 
return 
await 
_context 
. 
	WorkItems '
.' (
ToListAsync( 3
(3 4
)4 5
;5 6
} 
public!! 

async!! 
Task!! 
<!! 
WorkItem!! 
?!! 
>!!  
GetByIdAsync!!! -
(!!- .
Guid!!. 2
id!!3 5
)!!5 6
{"" 
return## 
await## 
_context## 
.## 
	WorkItems## '
.$$ 
Include$$ 
($$ 
wi$$ 
=>$$ 
wi$$ 
.$$ 
Comments$$ &
)$$& '
.%% 
FirstOrDefaultAsync%%  
(%%  !
wi%%! #
=>%%$ &
wi%%' )
.%%) *
Id%%* ,
==%%- /
id%%0 2
)%%2 3
;%%3 4
}&& 
public(( 

async(( 
Task(( 
<(( 
IEnumerable(( !
<((! "
WorkItem((" *
>((* +
>((+ ,
GetByProjectIdAsync((- @
(((@ A
Guid((A E
	projectId((F O
)((O P
{)) 
return** 
await** 
_context** 
.** 
	WorkItems** '
.++ 
Where++ 
(++ 
wi++ 
=>++ 
wi++ 
.++ 
	ProjectId++ %
==++& (
	projectId++) 2
)++2 3
.,, 
ToListAsync,, 
(,, 
),, 
;,, 
}-- 
public// 

async// 
Task// 
<// 
WorkItem// 
?// 
>//  
GetWithDetailsAsync//! 4
(//4 5
Guid//5 9
id//: <
)//< =
{00 
return11 
await11 
_context11 
.11 
	WorkItems11 '
.22 
Include22 
(22 
wi22 
=>22 
wi22 
.22 
Comments22 &
)22& '
.33 
Include33 
(33 
wi33 
=>33 
wi33 
.33 
History33 %
)33% &
.44 

AsTracking44 
(44 
)44 
.55 
FirstOrDefaultAsync55  
(55  !
wi55! #
=>55$ &
wi55' )
.55) *
Id55* ,
==55- /
id550 2
)552 3
;553 4
}66 
public88 

async88 
Task88 
UpdateAsync88 !
(88! "
WorkItem88" *
entity88+ 1
)881 2
{99 
_context:: 
.:: 
Entry:: 
(:: 
entity:: 
):: 
.:: 
State:: $
=::% &
EntityState::' 2
.::2 3
Modified::3 ;
;::; <
_context<< 
.<< 
Entry<< 
(<< 
entity<< 
)<< 
.<< 

Collection<< )
(<<) *
e<<* +
=><<, .
e<</ 0
.<<0 1
Comments<<1 9
)<<9 :
.<<: ;

IsModified<<; E
=<<F G
true<<H L
;<<L M
_context== 
.== 
Entry== 
(== 
entity== 
)== 
.== 

Collection== )
(==) *
e==* +
=>==, .
e==/ 0
.==0 1
History==1 8
)==8 9
.==9 :

IsModified==: D
===E F
true==G K
;==K L
await?? 
Task?? 
.?? 
CompletedTask??  
;??  !
}@@ 
publicBB 

asyncBB 
TaskBB 
AddCommentAsyncBB %
(BB% &
WorkItemCommentBB& 5
commentBB6 =
)BB= >
{CC 
awaitDD 
_contextDD 
.DD 
WorkItemCommentsDD '
.DD' (
AddAsyncDD( 0
(DD0 1
commentDD1 8
)DD8 9
;DD9 :
}EE 
publicGG 

asyncGG 
TaskGG 
AddHistoryAsyncGG %
(GG% &
WorkItemHistoryGG& 5
historyGG6 =
)GG= >
{HH 
awaitII 
_contextII 
.II 
WorkItemHistoriesII (
.II( )
AddAsyncII) 1
(II1 2
historyII2 9
)II9 :
;II: ;
}JJ 
}KK …
qC:\Labs\EclipseTechnicalChallenge\TaskManagement\src\TaskManagement.Infrastructure\Repositories\UserRepository.cs
	namespace 	
TaskManagement
 
. 
Infrastructure '
.' (
Repositories( 4
;4 5
public 
class 
UserRepository 
: 
IUserRepository -
{		 
private

 
readonly

  
ApplicationDbContext

 )
_context

* 2
;

2 3
public 

UserRepository 
(  
ApplicationDbContext .
context/ 6
)6 7
{ 
_context 
= 
context 
; 
} 
public 

async 
Task 
AddAsync 
( 
User #
entity$ *
)* +
{ 
await 
_context 
. 
Users 
. 
AddAsync %
(% &
entity& ,
), -
;- .
} 
public 

async 
Task 
DeleteAsync !
(! "
User" &
entity' -
)- .
{ 
_context 
. 
Users 
. 
Remove 
( 
entity $
)$ %
;% &
await 
Task 
. 
CompletedTask  
;  !
} 
public 

async 
Task 
< 
IEnumerable !
<! "
User" &
>& '
>' (
GetAllAsync) 4
(4 5
)5 6
{ 
return 
await 
_context 
. 
Users #
.# $
ToListAsync$ /
(/ 0
)0 1
;1 2
} 
public!! 

async!! 
Task!! 
<!! 
User!! 
?!! 
>!! 
GetByIdAsync!! )
(!!) *
Guid!!* .
id!!/ 1
)!!1 2
{"" 
return## 
await## 
_context## 
.## 
Users## #
.### $
	FindAsync##$ -
(##- .
id##. 0
)##0 1
;##1 2
}$$ 
public&& 

async&& 
Task&& 
UpdateAsync&& !
(&&! "
User&&" &
entity&&' -
)&&- .
{'' 
_context(( 
.(( 
Users(( 
.(( 
Update(( 
((( 
entity(( $
)(($ %
;((% &
await)) 
Task)) 
.)) 
CompletedTask))  
;))  !
}** 
}++ €!
tC:\Labs\EclipseTechnicalChallenge\TaskManagement\src\TaskManagement.Infrastructure\Repositories\ProjectRepository.cs
	namespace 	
TaskManagement
 
. 
Infrastructure '
.' (
Repositories( 4
;4 5
public 
class 
ProjectRepository 
:  
IProjectRepository! 3
{ 
private 
readonly  
ApplicationDbContext )
_context* 2
;2 3
public 

ProjectRepository 
(  
ApplicationDbContext 1
context2 9
)9 :
{ 
_context 
= 
context 
; 
} 
public 

async 
Task 
AddAsync 
( 
Project &
entity' -
)- .
{ 
await 
_context 
. 
Projects 
.  
AddAsync  (
(( )
entity) /
)/ 0
;0 1
} 
public 

async 
Task 
DeleteAsync !
(! "
Project" )
entity* 0
)0 1
{ 
_context 
. 
Projects 
. 
Remove  
(  !
entity! '
)' (
;( )
await 
Task 
. 
CompletedTask  
;  !
} 
public 

async 
Task 
< 
IEnumerable !
<! "
Project" )
>) *
>* +
GetAllAsync, 7
(7 8
)8 9
{   
return!! 
await!! 
_context!! 
.!! 
Projects!! &
.!!& '
ToListAsync!!' 2
(!!2 3
)!!3 4
;!!4 5
}"" 
public$$ 

async$$ 
Task$$ 
<$$ 
Project$$ 
?$$ 
>$$ 
GetByIdAsync$$  ,
($$, -
Guid$$- 1
id$$2 4
)$$4 5
{%% 
return&& 
await&& 
_context&& 
.&& 
Projects&& &
.&&& '
	FindAsync&&' 0
(&&0 1
id&&1 3
)&&3 4
;&&4 5
}'' 
public)) 

async)) 
Task)) 
<)) 
IEnumerable)) !
<))! "
Project))" )
>))) *
>))* +
GetByOwnerIdAsync)), =
())= >
Guid))> B
ownerId))C J
)))J K
{** 
return++ 
await++ 
_context++ 
.++ 
Projects++ &
.,, 
Where,, 
(,, 
p,, 
=>,, 
p,, 
.,, 
OwnerId,, !
==,," $
ownerId,,% ,
),,, -
.-- 
ToListAsync-- 
(-- 
)-- 
;-- 
}.. 
public00 

async00 
Task00 
<00 
Project00 
?00 
>00 !
GetWithWorkItemsAsync00  5
(005 6
Guid006 :
id00; =
)00= >
{11 
return22 
await22 
_context22 
.22 
Projects22 &
.33 
Include33 
(33 
p33 
=>33 
p33 
.33 
	WorkItems33 %
)33% &
.44 
FirstOrDefaultAsync44  
(44  !
p44! "
=>44# %
p44& '
.44' (
Id44( *
==44+ -
id44. 0
)440 1
;441 2
}55 
public77 

async77 
Task77 
UpdateAsync77 !
(77! "
Project77" )
entity77* 0
)770 1
{88 
_context99 
.99 
Projects99 
.99 
Update99  
(99  !
entity99! '
)99' (
;99( )
await:: 
Task:: 
.:: 
CompletedTask::  
;::  !
};; 
}<< Ö
lC:\Labs\EclipseTechnicalChallenge\TaskManagement\src\TaskManagement.Infrastructure\Persistence\UnitOfWork.cs
	namespace 	
TaskManagement
 
. 
Infrastructure '
.' (
Persistence( 3
;3 4
public 
class 

UnitOfWork 
: 
IUnitOfWork %
{ 
private 
readonly  
ApplicationDbContext )
_context* 2
;2 3
private		 
IProjectRepository		 
_projectRepository		 1
;		1 2
private

 
IWorkItemRepository

 
_workItemRepository

  3
;

3 4
public 


UnitOfWork 
(  
ApplicationDbContext *
context+ 2
)2 3
{ 
_context 
= 
context 
; 
} 
public 

IProjectRepository 
Projects &
=>' )
_projectRepository 
??= 
new "
ProjectRepository# 4
(4 5
_context5 =
)= >
;> ?
public 

IWorkItemRepository 
	WorkItems (
=>) +
_workItemRepository 
??= 
new  #
WorkItemRepository$ 6
(6 7
_context7 ?
)? @
;@ A
public 

async 
Task 
< 
int 
> 
CommitAsync &
(& '
)' (
{ 
return 
await 
_context 
. 
SaveChangesAsync .
(. /
)/ 0
;0 1
} 
public 

void 
Dispose 
( 
) 
{ 
_context 
. 
Dispose 
( 
) 
; 
} 
} å9
vC:\Labs\EclipseTechnicalChallenge\TaskManagement\src\TaskManagement.Infrastructure\Persistence\ApplicationDbContext.cs
	namespace 	
TaskManagement
 
. 
Infrastructure '
.' (
Persistence( 3
{ 
public		 

class		  
ApplicationDbContext		 %
:		& '
	DbContext		( 1
{

 
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Project 
> 
Projects &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DbSet 
< 
WorkItem 
> 
	WorkItems (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 
WorkItemComment $
>$ %
WorkItemComments& 6
{7 8
get9 <
;< =
set> A
;A B
}C D
public 
DbSet 
< 
WorkItemHistory $
>$ %
WorkItemHistories& 7
{8 9
get: =
;= >
set? B
;B C
}D E
public 
DbSet 
< 
ProjectMember "
>" #
ProjectMembers$ 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
<4 5 
ApplicationDbContext5 I
>I J
optionsK R
)R S
:T U
baseV Z
(Z [
options[ b
)b c
{ 	
} 	
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. +
ApplyConfigurationsFromAssembly 8
(8 9
typeof9 ?
(? @ 
ApplicationDbContext@ T
)T U
.U V
AssemblyV ^
)^ _
;_ `
modelBuilder 
. 
Entity 
<  
Project  '
>' (
(( )
)) *
. 
HasOne 
( 
p 
=> 
p 
. 
Owner $
)$ %
. 
WithMany 
( 
) 
. 
HasForeignKey 
( 
p  
=>! #
p$ %
.% &
OwnerId& -
)- .
. 
OnDelete 
( 
DeleteBehavior (
.( )
Restrict) 1
)1 2
;2 3
modelBuilder   
.   
Entity   
<    
Project    '
>  ' (
(  ( )
)  ) *
.!! 
HasMany!! 
(!! 
p!! 
=>!! 
p!! 
.!!  
Members!!  '
)!!' (
."" 
WithOne"" 
("" 
)"" 
.## 
HasForeignKey## 
(## 
pm## !
=>##" $
pm##% '
.##' (
	ProjectId##( 1
)##1 2
.$$ 
OnDelete$$ 
($$ 
DeleteBehavior$$ (
.$$( )
Cascade$$) 0
)$$0 1
;$$1 2
modelBuilder&& 
.&& 
Entity&& 
<&&  
ProjectMember&&  -
>&&- .
(&&. /
)&&/ 0
.'' 
HasOne'' 
<'' 
User'' 
>'' 
('' 
)'' 
.(( 
WithMany(( 
((( 
)(( 
.)) 
HasForeignKey)) 
()) 
pm)) !
=>))" $
pm))% '
.))' (
UserId))( .
))). /
.** 
OnDelete** 
(** 
DeleteBehavior** (
.**( )
Cascade**) 0
)**0 1
;**1 2
modelBuilder,, 
.,, 
Entity,, 
<,,  
Project,,  '
>,,' (
(,,( )
),,) *
.-- 
Ignore-- 
(-- 
$str--  
)--  !
;--! "
modelBuilder// 
.// 
Entity// 
<//  
WorkItem//  (
>//( )
(//) *
)//* +
.00 
Property00 
(00 
w00 
=>00 
w00  
.00  !
Status00! '
)00' (
.11 
HasConversion11 
<11 
string11 %
>11% &
(11& '
)11' (
.22 
HasMaxLength22 
(22 
$num22  
)22  !
;22! "
modelBuilder44 
.44 
Entity44 
<44  
WorkItem44  (
>44( )
(44) *
)44* +
.55 
Property55 
(55 
w55 
=>55 
w55  
.55  !
Priority55! )
)55) *
.66 
HasConversion66 
<66 
string66 %
>66% &
(66& '
)66' (
.77 
HasMaxLength77 
(77 
$num77  
)77  !
;77! "
modelBuilder99 
.99 
Entity99 
<99  
WorkItem99  (
>99( )
(99) *
)99* +
.:: 
HasMany:: 
(:: 
w:: 
=>:: 
w:: 
.::  
Comments::  (
)::( )
.;; 
WithOne;; 
(;; 
);; 
.<< 
HasForeignKey<< 
(<< 
c<<  
=><<! #
c<<$ %
.<<% &

WorkItemId<<& 0
)<<0 1
.== 
OnDelete== 
(== 
DeleteBehavior== (
.==( )
Cascade==) 0
)==0 1
;==1 2
modelBuilder?? 
.?? 
Entity?? 
<??  
WorkItem??  (
>??( )
(??) *
)??* +
.@@ 

Navigation@@ 
(@@ 
w@@ 
=>@@  
w@@! "
.@@" #
Comments@@# +
)@@+ ,
.AA !
UsePropertyAccessModeAA &
(AA& '
PropertyAccessModeAA' 9
.AA9 :
FieldAA: ?
)AA? @
.BB 
AutoIncludeBB 
(BB 
)BB 
;BB 
modelBuilderDD 
.DD 
EntityDD 
<DD  
WorkItemDD  (
>DD( )
(DD) *
)DD* +
.EE 

NavigationEE 
(EE 
wEE 
=>EE  
wEE! "
.EE" #
HistoryEE# *
)EE* +
.FF !
UsePropertyAccessModeFF &
(FF& '
PropertyAccessModeFF' 9
.FF9 :
FieldFF: ?
)FF? @
.GG 
AutoIncludeGG 
(GG 
)GG 
;GG 
}HH 	
}II 
}JJ °
iC:\Labs\EclipseTechnicalChallenge\TaskManagement\src\TaskManagement.Infrastructure\DependencyInjection.cs
	namespace 	
TaskManagement
 
. 
Infrastructure '
;' (
public

 
static

 
class

 
DependencyInjection

 '
{ 
public 

static 
IServiceCollection $0
$AddInfrastructureDependencyInjection% I
(I J
thisJ N
IServiceCollectionO a
servicesb j
,j k
IConfiguration 
configuration $
)$ %
{ 
string $
connectionStringTemplate '
=( )
configuration* 7
.7 8
GetConnectionString8 K
(K L
$strL _
)_ `
!` a
;a b
string 
connectionString 
=  !$
connectionStringTemplate" :
.
 
Replace 
( 
$str  
,  !
Environment" -
.- ."
GetEnvironmentVariable. D
(D E
$strE Q
)Q R
)R S
.
 
Replace 
( 
$str $
,$ %
Environment& 1
.1 2"
GetEnvironmentVariable2 H
(H I
$strI Y
)Y Z
)Z [
.
 
Replace 
( 
$str $
,$ %
Environment& 1
.1 2"
GetEnvironmentVariable2 H
(H I
$strI Y
)Y Z
)Z [
.
 
Replace 
( 
$str  
,  !
Environment" -
.- ."
GetEnvironmentVariable. D
(D E
$strE Q
)Q R
)R S
.
 
Replace 
( 
$str  
,  !
Environment" -
.- ."
GetEnvironmentVariable. D
(D E
$strE Q
)Q R
)R S
;S T
services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
{ 	
options 
. 
UseMySQL 
( 
connectionString -
)- .
;. /
} 	
)	 

;
 
services 
. 
	AddScoped 
< 
IProjectRepository -
,- .
ProjectRepository/ @
>@ A
(A B
)B C
;C D
services 
. 
	AddScoped 
< 
IWorkItemRepository .
,. /
WorkItemRepository0 B
>B C
(C D
)D E
;E F
services 
. 
	AddScoped 
< 
IUserRepository *
,* +
UserRepository, :
>: ;
(; <
)< =
;= >
services 
. 
	AddScoped 
< 
IUnitOfWork &
,& '

UnitOfWork( 2
>2 3
(3 4
)4 5
;5 6
return!! 
services!! 
;!! 
}"" 
}## 